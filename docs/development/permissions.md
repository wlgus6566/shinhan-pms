# 권한 체계

## 역할 구분

### 시스템 역할 (UserRole)
사용자 계정에 부여되는 전역 역할입니다.

| 역할 | 코드 | 설명 |
|------|------|------|
| 슈퍼 관리자 | `SUPER_ADMIN` | 시스템 전체 관리 권한 |
| 프로젝트 관리자 | `PM` | 프로젝트 관리 권한 |
| 일반 | `MEMBER` | 기본 사용자 |

### 프로젝트 역할 (MemberRole)
프로젝트 멤버에게 부여되는 프로젝트 내 역할입니다.

| 역할 | 코드 | 설명 |
|------|------|------|
| PM | `PM` | 프로젝트 매니저 |
| PL | `PL` | 파트 리더 |
| PA | `PA` | 프로젝트 참여자 |

---

## 기능별 권한 매트릭스

### 사용자 관리 (`/api/users`)

| 기능 | SUPER_ADMIN | PM | MEMBER |
|------|:-----------:|:--:|:------:|
| 사용자 생성 | O | X | X |
| 사용자 목록 조회 | O | O | X |
| 사용자 상세 조회 | O | O | X |
| 사용자 정보 수정 | O | X | X |
| 사용자 비활성화 | O | X | X |
| 비밀번호 초기화 | O | O | X |

> 구현: `@Roles()` 데코레이터 + `RolesGuard` (컨트롤러 레벨)

### 프로젝트 관리 (`/api/projects`)

| 기능 | SUPER_ADMIN | PM | MEMBER |
|------|:-----------:|:--:|:------:|
| 프로젝트 생성 | O | O | O |
| 프로젝트 목록 조회 | O | O | O |
| 내 프로젝트 조회 | O (전체) | O (소속) | O (소속) |
| 프로젝트 상세 조회 | O | O | O |
| 프로젝트 수정 | O | O | O |
| 프로젝트 삭제 | O | O | O |

> 참고: 현재 프로젝트 CRUD는 인증된 사용자 모두 접근 가능 (`JwtAuthGuard`만 적용)

### 프로젝트 멤버 관리 (`/api/projects/:id/members`)

| 기능 | SUPER_ADMIN | 시스템 PM | 프로젝트 PM | PL | PA |
|------|:-----------:|:---------:|:----------:|:--:|:--:|
| 멤버 목록 조회 | O | O | O | O | O |
| 멤버 추가 | O | O | O | X | X |
| 멤버 역할 수정 | O | O | O | X | X |
| 멤버 제거 | O | O | O | X | X |

> 구현: `checkMemberManagePermission()` (서비스 레벨)
> 조건: 시스템 `SUPER_ADMIN` 또는 시스템 `PM` 또는 해당 프로젝트 멤버 중 역할이 `PM`

### 업무 관리 (`/api/tasks`)

| 기능 | 조건 |
|------|------|
| 업무 생성/수정/삭제 | 프로젝트 멤버만 가능 |

> 구현: 서비스 레벨에서 프로젝트 멤버 여부 확인

### 업무 구분 관리 (`/api/project-task-types`)

| 기능 | 조건 |
|------|------|
| 업무 구분 관리 | 프로젝트 멤버만 가능 |

> 구현: 서비스 레벨에서 프로젝트 멤버 여부 확인

### 업무일지 (`/api/work-logs`)

| 기능 | 조건 |
|------|------|
| 업무일지 작성 | 프로젝트 멤버 (PM 제외) |
| 업무일지 수정 | 본인 작성분만 |
| 업무일지 삭제 | 본인 작성분만 |

### 일정 관리 (`/api/schedules`)

| 기능 | 조건 |
|------|------|
| 프로젝트 일정 생성 | 프로젝트 멤버만 가능 |
| 일정 수정 | 본인 생성분만 |
| 일정 삭제 | 본인 생성분만 |

### 분석/통계 (`/api/analytics`)

| 기능 | SUPER_ADMIN | PM | MEMBER |
|------|:-----------:|:--:|:------:|
| 투입 인력 현황 | O | O | X |
| 월간 업무 현황 | O | O | X |

> 구현: `@Roles()` 데코레이터 + `RolesGuard` (컨트롤러 레벨)

---

## 권한 구현 방식

### 1. 컨트롤러 레벨 - `@Roles()` + `RolesGuard`
시스템 역할(UserRole) 기반 접근 제어. 엔드포인트 단위로 적용.

```typescript
@UseGuards(JwtAuthGuard, RolesGuard)
@Roles('SUPER_ADMIN', 'PM')
async someEndpoint() { ... }
```

### 2. 서비스 레벨 - 비즈니스 로직 내 검증
프로젝트 역할, 소유권 등 세밀한 권한 체크.

```typescript
// 프로젝트 멤버 관리 권한
await this.checkMemberManagePermission(projectId, userId, userRole);

// 본인 소유권 체크
if (entity.createdBy !== userId) {
  throw new ForbiddenException('본인이 생성한 항목만 수정할 수 있습니다');
}
```

---

## 마지막 업데이트
2026-02-25
